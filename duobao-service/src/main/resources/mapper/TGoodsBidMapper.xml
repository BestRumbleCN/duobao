<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="team.wuxie.crowdfunding.mapper.TGoodsBidMapper" >
  <resultMap id="BaseResultMap" type="team.wuxie.crowdfunding.domain.TGoodsBid" >
    <!--
      WARNING - @mbggenerated
    -->
    <constructor >
      <idArg column="bid_id" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="goods_id" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="total_amount" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="join_amount" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="bid_status" jdbcType="TINYINT" javaType="team.wuxie.crowdfunding.domain.BidStatus" typeHandler="team.wuxie.crowdfunding.util.mybatis.typehandler.BidStatusTypeHandler" />
      <arg column="winner_id" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="lucky_num" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="publish_time" jdbcType="TIMESTAMP" javaType="java.util.Date" />
      <arg column="create_time" jdbcType="TIMESTAMP" javaType="java.util.Date" />
      <arg column="update_time" jdbcType="TIMESTAMP" javaType="java.util.Date" />
      <arg column="single_price" jdbcType="INTEGER" javaType="java.util.Date" />
    </constructor>
  </resultMap>
  
  <resultMap id="GoodsBidVO" type="team.wuxie.crowdfunding.vo.GoodsBidVO">
        <id column="bid_id" property="bidId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="goods_id" property="goodsId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="type_id" property="typeId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="channel" property="channel" jdbcType="INTEGER"
	javaType="java.lang.Integer" />
        <result column="winner_id" property="winnerId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="lucky_num" property="luckyNum" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="join_amount" property="joinAmount" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="goods_name" property="goodsName" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result column="goods_status" property="goodsStatus" jdbcType="BIT" javaType="java.lang.Boolean"/>
        <result column="bid_status" property="bidStatus" jdbcType="BIT" javaType="team.wuxie.crowdfunding.domain.BidStatus" typeHandler="team.wuxie.crowdfunding.util.mybatis.typehandler.BidStatusTypeHandler"/>
        <result column="statement" property="statement" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result column="total_amount" property="totalAmount" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="single_price" property="singlePrice" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="img" property="img" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result column="img_detail" property="imgDetail" jdbcType="VARCHAR" javaType="java.lang.String"/>
   		 <result column="publish_time" property="publishTime" jdbcType="TIMESTAMP" javaType="java.util.Date"/>
    </resultMap>
    
     <select id="selectVOsByChannel" resultMap="GoodsBidVO">
		SELECT t.bid_id,t.goods_id,t.total_amount,t.single_price,t.join_amount,t.bid_status,t.winner_id,t.lucky_num,t.publish_time,t2.img,t2.img_detail,t2.goods_name,t2.channel,t2.type_id
		FROM t_goods_bid t
		INNER JOIN t_goods t2 ON t.goods_id = t2.goods_id AND t2.channel =  #{channel,jdbcType=INTEGER} AND t.bid_status=1
     </select>
     
     <select id="selectVOsByTotalAmount" resultMap="GoodsBidVO">
		SELECT t.bid_id,t.goods_id,t.total_amount,t.single_price,t.join_amount,t.bid_status,t.winner_id,t.lucky_num,t.publish_time,t2.img,t2.img_detail,t2.goods_name,t2.channel,t2.type_id
		FROM t_goods_bid t
		INNER JOIN t_goods t2 ON t.goods_id = t2.goods_id AND t.bid_status=1 order by t.total_amount desc
     </select>
     
     <select id="selectVOsByPercent" resultMap="GoodsBidVO">
		SELECT t.bid_id,t.goods_id,t.total_amount,t.single_price,t.join_amount,t.bid_status,t.winner_id,t.lucky_num,t.publish_time,t2.img,t2.img_detail,t2.goods_name,t2.channel,t2.type_id,t.join_amount/t.total_amount percent
		FROM t_goods_bid t
		INNER JOIN t_goods t2 ON t.goods_id = t2.goods_id AND t.bid_status=1 order by percent desc
     </select>
     
     <select id="selectAllVOs" resultMap="GoodsBidVO">
		SELECT
		t.bid_id,t.goods_id,t.total_amount,t.single_price,t.join_amount,t.bid_status,t.winner_id,t.lucky_num,t.publish_time,t2.img,t2.img_detail,t2.goods_name,t2.channel,t2.type_id,t.join_amount/t.total_amount
		percent
		FROM t_goods_bid t
		INNER JOIN t_goods t2 ON t.goods_id =
		t2.goods_id AND t.bid_status=1
	</select>
     <select id="selectLastByGoodsId" resultMap="BaseResultMap">
     	select * from t_goods_bid where goods_id = #{goodsId,jdbcType=INTEGER} order by create_time desc limit 0,1;
     </select>
</mapper>